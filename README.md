# SummarisedStats

## Introduction

SummarisedStats generates the summarised statistics (e.g. Median, Min, Max, and Percentiles) for the sleep statistics of the participants who took part in the Actigraphy activity. SummarisedStats will also plot the boxplot of various sleep variables (e.g. Sleep Efficiency) so that the research team can analyse the difference in sleep patterns between the control and the intervention groups.

## Functions of each scripts

There are three scripts that work hand in hand to produced the desired output. They are:

1) `data_summariser.py`
2) `data_exporter.py`
3) `condensing_excel_output.py`
4) `plotting_boxplots.py`

`data_summariser.py` will open the csv and then iterate through the data that was obtained from the Philips Actiware software for each subject, and extract out the relevant data. The script will then calculate the minimum, maximum, mean, 25th, 50th (A.K.A median), and 75th percentile, as well as the standard deviation for each of the variables that were extracted.

`data_exporter.py` will first create a folder called `formatted_data` within the location that houses the xlsx files generated by the Philips Actiware, then export the resultant summarised data as a table into their respective individual excel workbook based on the subject's code into the `formatted_data` folder.

`remove_unconsented.py` is a script that looks at the participants manifest and see and note down if there are anyone who have withdrawn their consent/did not consent to the study in a form of a list. The script will then iterate through the excel files generated by `data_exporter.py` and send the files to the recycling bin if that file belongs to the person that are identified in the list.

`condensing_excel_output.py` will first called upon `remove_unconsented.py` and verify if the user would want to omit data from participants who did not consent/withdrawn their consent from the research. Regardless of what the user has chosen, the `condensing_excel_output.py` will then proceed to iterate through all the available excel workbooks that were generated by `data_exporter.py`, grab the median data from each research participants, and then store them in a separate excel workbook called `Consolidated Median Value.xlsx`. Finally, `condensing_excel_output.py` will then merge all the participants' data into a single excel workbook called `Consolidated Stats.xlsx`

`plotting_boxplot.py` generates boxplot using seaborn and plotly. It will also generate a summarised data as an excel file to enable one to check the validity of the data.

## Pre-requisites

Please ensure that you have the following software installed on your computer:

- Python 3.9+
- ```Pandas``` library installed
  - You may install pandas using pip via the following command in Command Prompt/Powershell/terminal:
  ```pip install -U pandas```
   <br/>
- `xlsxwriter` module installed
  - You may enter the following command in the Command Prompt/Powershell/terminal to install the module:
  ```pip install -U xlsxwriter```
  <br/>
- `send2trash` module installed
  - You may enter the following command in the Command Prompt/Powershell/terminal:
  ```pip install -U send2trash```
  <br/>
- `seaborn` and `plotly` modules installed
  - You may enter the following command in the Command Prompt/Powershell/terminal:
 ```pip install -U seaborn plotly```

## How to use

You will only need to change the settings in the ```data_exporter.py``` and ```condensing_excel_output.py```.

### data_exporter.py

In the `User Input` section of the script, edit the `working_directory` variable with the filepath containing the CSV outputs generated from Philips Actiware software. Replace all `\` symbols with `/` symbol (without the quotation marks) in the filepath if you are using Windows. An example is shown below:

Do the same for the `location_of_manifest` variable with the filepath that points to the manifest location. Replace all `\` symbols with `/` (without the quotation marks) in the filepath if you are using Windows.

The result should look something like this:
<img src='img/data exporter user input.png'>

Run the script. If you are using the default Python IDE, press 'F5' to run the script. If you are using a different IDE (e.g. Sublime Text or VSCode, etc.), use the respective IDE's keyboard shortcut to run the script.

The summarised xlsx files generated by this script is now located in the `formatted_data` folder.

### condensing_excel_output.py

After using the `data_exporter.py`, open `condensing_excel_output.py` using an IDE and edit the `working_directory` variable in the `user input` section with the filepath containing the summarised xlsx files. If you are using Windows, replace all '\\' symbols with '/' (without the quotation marks).

Run the script. If you are using the IDE that came with Python, the keyboard shortcut is 'F5'. For other IDEs (e.g. Sublime Text, VSCode, etc), refer to the IDE's manual on the shortcut to run the file.

The consolidated excel file containing all the summarised stats will be generated.This consolidated excel file has the default filename of `Consolidated stats.xlsx`

### plotting_boxplot.py

Once the `Consolidated stats.xlsx` has been generated, isolate the median for each research participants into another excel workbook. Make sure you have a header for each column of the data. For best results, you can copy the headers from `Consolidated stats.xlsx`. You should format the excel data as shown below:

<img src= 'img/Median consolidation examples.png'>

Simply run the script using your IDE and the boxplot for each of the variables will be generated. Note that by default, the script will generate both png file and html file. The former is created using the seaborn package while the latter is generated using the plotly package. For this script, the html file should only be used as a reference to check the validity of the boxplot that was generated as a png format.

This script will also generate another summarised stats based on the data that you just created. This summarised stats is similar to the ones that were generated by `data_exporter.py` and `data_summariser.py` scripts, and can be used to check on the validity of the boxplot. The filename for this summarised stat is `Summarised Stats.xlsx`.

## Caveats

There are some caveats you should take note of while using the script.

1. Currently, boxplots that are plotted using the seaborn package (i.e. file whose extension is with `.png`) are not labelled with their median. To circumvent this, the script will generate the `Summarised Stats.xlsx` and the plotly graphs so that you can check the validity of the graphs plotted.

2. The `data_exporter.py` and `data_summariser.py` require a participant manifest to work. A participants manifest is a file (usually an excel file) that contains the participants' details. Different research groups will have different way in formatting their participants' manifest. These scripts are tailored to the structure of our research group's participants manifest. Thus, you will need to edit both `data_exporter.py` and `data_summariser.py` to suit the format of your participants manifest.
